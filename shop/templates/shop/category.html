{% extends "base.html" %}
{% load static %}
{% block title %}{{ category.name }} – ToDianeDev Shop{% endblock %}
{% block meta_description %}
Browse {{ category.name }} products including digital downloads, templates, and bookkeeping tools created for UK self-employed users.
{% endblock %}

{% block open_graph_tags %}
<meta property="og:title" content="{{ category.name }} – ToDianeDev Shop">
<meta property="og:description" content="Explore digital products in the {{ category.name }} category.">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="https://todiane.com/static/images/dianec-gray2.webp">
{% endblock %}

{% block extra_head %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">

<meta name="ai-page-type" content="shop-category" />
<meta name="ai-category" content="{{ category.name }}" />

<!-- JSON-LD ItemList -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "{{ category.name }} – Product List",
  "url": "{{ request.build_absolute_uri }}",
  "itemListElement": [
    {% for product in products %}
    {
      "@type": "ListItem",
      "position": {{ forloop.counter }},
      "url": "{{ product.get_absolute_url }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endblock %}


{% block content %}
<section class="w-full  py-12">
  <div class="max-w-6xl mx-auto px-6 bg-white rounded-xl shadow-md p-10">
    

    <!-- Category Header -->
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-bold text-[color:var(--color-brand-primary)] mb-3">
        {{ category.name }}
      </h1>
      <a href="{% url 'shop:category_hub' %}" 
         class="text-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-accent)] underline transition">
        ← Back to Categories
      </a>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {% for product in products %}
      <article class="bg-white border border-[color:var(--color-brand-accent)]/40 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition flex flex-col">
        <a href="{{ product.get_absolute_url }}">
          {% if product.get_image_url %}
          <img src="{{ product.get_image_url }}" 
               alt="shop category for {{ product.title }}" 
               width="700" height="900" 
               loading="lazy" decoding="async"
               class="w-full h-56 object-cover">
          {% else %}
          <div class="w-full h-56 bg-[color:var(--color-brand-light)] flex items-center justify-center text-[color:var(--color-brand-accent)]">
            No Image Available
          </div>
          {% endif %}
        </a>

        <div class="p-6 flex flex-col flex-grow">
          <h2 class="text-lg font-bold text-[color:var(--color-brand-primary)] mb-2">
            {{ product.title }}
          </h2>
          <p class="text-[color:var(--color-font-main)]/80 text-sm mb-4">
            {{ product.description|striptags|truncatewords:20 }}
          </p>

          <div class="flex items-center justify-between mt-auto">
            <span class="text-lg font-semibold text-[color:var(--color-font-main)]">
              £{{ product.current_price|floatformat:2 }}
            </span>
            <a href="{{ product.get_absolute_url }}" 
               class="text-[color:var(--color-brand-secondary)] hover:text-[color:var(--color-brand-accent)] font-semibold text-sm transition">
              View Details →
            </a>
          </div>
        </div>
      </article>
      {% empty %}
      <div class="col-span-3 text-center py-12 bg-gray-50 border border-[color:var(--color-brand-accent)]/20 rounded-lg">
        <p class="text-[color:var(--color-font-main)]/70">
          New products coming soon.
        </p>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if products.has_other_pages %}
    <div class="flex justify-center items-center gap-2 mt-12 flex-wrap">
      {% if products.has_previous %}
      <a href="?page={{ products.previous_page_number }}" 
         class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">
        Previous
      </a>
      {% endif %}

      {% for i in products.paginator.page_range %}
      {% if products.number == i %}
      <span class="px-4 py-2 bg-[color:var(--color-brand-primary)] text-white border border-[color:var(--color-brand-primary)] rounded">
        {{ i }}
      </span>
      {% else %}
      <a href="?page={{ i }}" 
         class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">
        {{ i }}
      </a>
      {% endif %}
      {% endfor %}

      {% if products.has_next %}
      <a href="?page={{ products.next_page_number }}" 
         class="px-4 py-2 border border-[color:var(--color-brand-primary)] text-[color:var(--color-brand-primary)] rounded hover:bg-[color:var(--color-brand-primary)] hover:text-white transition">
        Next
      </a>
      {% endif %}
    </div>
    {% endif %}

    <!-- Back to Shop -->
    <div class="mt-12 text-center">
      <a href="{% url 'shop:product_list' %}" 
         class="inline-block px-6 py-3 rounded-lg bg-[color:var(--color-brand-accent)] text-white font-semibold hover:opacity-90 transition">
        Back to Shop
      </a>
    </div>

  </div>
</section>
{% endblock %}
